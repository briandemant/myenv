#!/usr/bin/env bash
runcron(){ 
	if [ -f /var/www/*/*/$2admin.php ] ; then
		php /var/www/*/cron/cronRunner.php /var/www/*/cron/.. /var/www/*/cron/jobs/$1.php /var/www/*/*/$2admin.php 1320168191 || echo "ERROR"
	else
		php /var/www/*/cron/cronRunner.php /var/www/*/cron/.. /var/www/*/cron/jobs/$1.php /var/www/*/*/$2.php 1320168191 || echo "ERROR"
	fi
}

lesslog(){
	local inst
	if [ -f /var/www/*/*/$2admin.php ] ; then
		inst=$2admin.log
	else
		inst=$2.log
	fi

	if [[ "$3" == "" ]] ; then
		less /var/www/*/cron/log/$1/$(date +%Y-%m-%d)/$inst
	else
		less /var/www/*/cron/log/$1/$3/$inst
	fi
}

taillog(){
	local inst
	if [ -f /var/www/*/*/$2admin.php ] ; then
		inst=$2admin.log
	else
		inst=$2.log
	fi
	
	if [[ "$3" == "" ]] ; then
		tail -f -n10000 /var/www/*/cron/log/$1/$(date +%Y-%m-%d)/$inst
	else
		tail -f -n10000 /var/www/*/cron/log/$1/$3/$inst
	fi
}

_logs() 
{
	local cur prev
	cur=${COMP_WORDS[COMP_CWORD]}
	prev="${COMP_WORDS[COMP_CWORD-1]}"
	case "$prev" in
		lesslog|taillog)
			COMPREPLY=( $(compgen -W "$(cd /var/www/*/cron/log/;ls -d *|grep '/' | sed 's/ /\\ /g' |cut -f1 -d\/)" -- $cur) )
			return 0
			;;
		*)
			COMPREPLY=( $(compgen -W "$(cd /var/www/*/cron/log/$prev/;ls -d *|grep '/' | sed 's/ /\\ /g' |cut -f1 -d\/)" -- $cur) )
			return 0
			;;
	esac
}

complete -F _logs lesslog
complete -F _logs taillog
